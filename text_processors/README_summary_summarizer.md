# Summary Summarizer

## Описание

`SummarySummarizer` - это инструмент для создания краткой сводки из summary файлов. Он автоматически извлекает введение и создает краткую сводку по каждому фрагменту, убирая дублирующиеся заголовки.

## Возможности

- **Извлечение введения**: Автоматически находит и извлекает текст до первого фрагмента
- **Обработка фрагментов**: Находит все заголовки "Фрагмент N" и создает краткую сводку
- **Устранение дублирования**: Убирает повторяющиеся заголовки "Фрагмент N"
- **Настраиваемый размер**: Можно указать количество строк для извлечения из каждого фрагмента
- **Статистика**: Предоставляет детальную информацию о структуре summary файла

## Использование

### Как отдельный скрипт

```bash
# Базовое использование
python summary_summarizer.py path/to/summary_file.txt

# С указанием выходного файла
python summary_summarizer.py path/to/summary_file.txt -o output.txt

# С указанием количества строк на фрагмент
python summary_summarizer.py path/to/summary_file.txt -l 3

# Показать статистику
python summary_summarizer.py path/to/summary_file.txt -s

# Комбинированное использование
python summary_summarizer.py path/to/summary_file.txt -o output.txt -l 5 -s
```

### Параметры командной строки

- `summary_file` - Путь к summary файлу (обязательный)
- `-o, --output` - Путь к выходному файлу (по умолчанию: `{filename}_summary.txt`)
- `-l, --lines` - Количество строк для извлечения из каждого фрагмента (по умолчанию: 5)
- `-s, --stats` - Показать статистику по файлу

### Как модуль в Python

```python
from summary_summarizer import SummarySummarizer

# Создание экземпляра
summarizer = SummarySummarizer("path/to/summary.txt")

# Получение статистики
stats = summarizer.get_statistics()
print(f"Всего фрагментов: {stats['total_fragments']}")

# Создание сводки
summary = summarizer.create_summary(
    output_file="output.txt",
    lines_per_fragment=3
)
```

## Интеграция с Full Pipeline

`SummarySummarizer` автоматически интегрирован в `full_pipeline.py` и запускается после создания summary файла. 

### Автоматическое создание

При запуске полного пайплайна с созданием summary автоматически создается файл `*_short_summary.txt`:

```bash
python full_pipeline.py "book.pdf" --output "results"
```

Это создаст:
1. `*_raw.txt` - Исходный текст
2. `*_clean.txt` - Очищенный текст  
3. `*_summary_*.txt` - Полный пересказ
4. `*_short_summary.txt` - Краткая сводка ← **НОВЫЙ ФАЙЛ**
5. `*_report.txt` - Отчет о работе

### Настройки по умолчанию

В полном пайплайне краткая сводка создается с настройками:
- 3 строки на фрагмент
- Автоматическое имя файла: `{filename}_short_summary.txt`
- Сохранение в ту же директорию, что и summary

## Структура выходного файла

```
[Введение до первого фрагмента]

================================================================================
КРАТКАЯ СВОДКА ПО ФРАГМЕНТАМ
================================================================================

--- ФРАГМЕНТ 1 ---

[Первые несколько строк фрагмента 1]

----------------------------------------

--- ФРАГМЕНТ 2 ---

[Первые несколько строк фрагмента 2]

----------------------------------------

...
```

## Примеры использования

### Пример 1: Создание краткой сводки

```bash
python summary_summarizer.py pipeline_Gantrip_150_200/summary_educational.txt -l 3
```

Создаст файл `summary_educational_summary.txt` с 3 строками на фрагмент.

### Пример 2: Получение статистики

```bash
python summary_summarizer.py pipeline_Gantrip_150_200/summary_educational.txt -s
```

Выведет информацию о количестве фрагментов, размере файла и детали по каждому фрагменту.

### Пример 3: Интеграция в пайплайн

```bash
python full_pipeline.py "book.pdf" --page-range "1-50" --output "results"
```

Автоматически создаст все файлы, включая краткую сводку.

## Преимущества

1. **Автоматизация**: Не требует ручного редактирования
2. **Консистентность**: Единый формат для всех сводок
3. **Эффективность**: Быстрый обзор содержания без чтения полного summary
4. **Интеграция**: Работает как отдельно, так и в составе пайплайна
5. **Гибкость**: Настраиваемое количество строк на фрагмент

## Требования

- Python 3.7+
- Стандартные библиотеки: `os`, `re`, `argparse`, `pathlib`, `typing`

## Обработка ошибок

Скрипт корректно обрабатывает:
- Отсутствующие файлы
- Файлы без фрагментов
- Проблемы с кодировкой
- Ошибки записи файлов

## Поддержка

Для получения помощи используйте:
```bash
python summary_summarizer.py --help
```
