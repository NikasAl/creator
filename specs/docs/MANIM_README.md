# Manim Video Lesson Generator

Система для генерации образовательных видео-уроков с использованием manim, которая синхронизирует видео-анимацию с аудио дорожкой.

## Быстрый старт

### 1. Создание нового пайплайна

Запустите мастер-скрипт для создания нового пайплайна:

```bash
./setup_manim_pipeline.sh
```

Скрипт запросит:
- Название пайплайна (например: `math_lesson_1`)
- Заголовок (TITLE) и автора (AUTHOR)
- Содержимое spec.txt (описание задачи и затруднений, которые нужно разобрать)
- Путь к изображению задачи (опционально)
- Выбор примера кода из библиотеки для стилизации генерации

Создаст директорию `pipelines_manim/PIPELINE_NAME/`, разместит необходимые файлы и создаст конфигурационный файл `configs/manim/PIPELINE_NAME.conf`.

### 2. Обработка пайплайна

Запустите основной скрипт обработки:

```bash
./process_manim.sh configs/manim/PIPELINE_NAME.conf
```

Скрипт выполнит следующие шаги:

1. **Генерация текста урока** - создание сценария для видеоурока на основе spec.txt
2. **Ожидание аудио** - проверка наличия аудио дорожки (audio.mp3)
3. **Транскрибация** - создание таймстампов предложений с помощью Whisper
4. **Генерация manim кода** - создание Python кода анимации на основе спецификации и таймстампов
5. **Рендеринг видео** - запуск manim для создания видео
6. **Синхронизация с аудио** - объединение manim видео с аудио дорожкой
7. **Создание промо-описания** - генерация описания для публикации
8. **Создание обложки** - открытие видео в mpv и создание скриншота нужного момента через хоткей PrintScreen
9. **Создание статьи для Пикабу** - генерация текста статьи с кратким содержанием, остротами и юмором

## Структура файлов

```
pipelines_manim/
  PIPELINE_NAME/
    spec.txt            # Спецификация задачи и затруднений
    spec.jpg/png        # Изображение задачи (опционально)
    manim_example.py    # Пример кода для стилизации генерации
    lesson_script.txt   # Сгенерированный текст урока
    audio.mp3           # Аудио дорожка
    sentence_timestamps.json  # Таймстампы предложений
    manim_lesson.py     # Сгенерированный manim код
    manim_video.mp4     # Видео без аудио
    video.mp4           # Финальное видео с синхронизированным аудио
    cover.jpg           # Обложка, извлеченная из видео
    promo_description.txt  # Промо-описание
    pikabu_article.txt  # Статья для Пикабу с остротами и юмором
```

## Конфигурация

Конфигурационный файл содержит:

- `BASE_DIR` - путь к директории пайплайна (обязательно)
- `TITLE` - заголовок урока (обязательно)
- `AUTHOR` - автор (обязательно)
- `LANGUAGE` - язык транскрипции (по умолчанию: ru)
- `SCRIPT_MODEL` - модель для генерации текста урока (по умолчанию: custom)
- `CODE_MODEL` - модель для генерации manim кода (по умолчанию: custom)
- `PROMO_MODEL` - модель для генерации промо-описания (по умолчанию: default)
- `QUALITY` - качество рендера: low, medium, high, 4k (по умолчанию: low)

## Формат спецификации (spec.txt)

Спецификация должна описывать:
- Формулировку задачи и затруднений
- Ход решения и ключевые моменты
- Ошибки и как их избежать
- Выводы и уроки, которые можно извлечь

Пример:

```
Задача: Решить уравнение 2x + 5 = 15.

Мои затруднения: Не могу правильно перенести слагаемые из одной части уравнения в другую.

Ход решения:
1. Исходное уравнение: 2x + 5 = 15
2. Вычитаем 5 из обеих частей: 2x = 10
3. Делим обе части на 2: x = 5
4. Проверка: 2*5 + 5 = 15 ✓

Уроки: При переносе слагаемого из одной части уравнения в другую, знак меняется на противоположный.
```

## Пример использования

1. Создайте новый пайплайн:
   ```bash
   ./setup_manim_pipeline.sh
   # Введите: math_example
   # Введите заголовок и автора
   # Опишите задачу и затруднения
   # Укажите путь к изображению задачи (опционально)
   # Выберите пример кода
   ```

2. Сгенерируйте текст урока (описание в lesson_script.txt будет создано LLM или введено вами вручную)

3. Создайте аудио дорожку:
   - Используйте TTS для преобразования lesson_script.txt в audio.mp3
   - Или запишите озвучку вручную

4. Запустите обработку:
   ```bash
   ./process_manim.sh configs/manim/math_example.conf
   ```

5. Если результат не устраивает, можно:
   - Перегенерировать код через LLM с помощью custom режима
   - Вручную исправить `pipelines_manim/math_example/manim_lesson.py` и запустить manim render вручную
   - Перезапустить процесс с другим качеством рендера

## Зависимости

- manim (для генерации анимаций)
- ffmpeg (для обработки видео и синхронизации)
- python-whisper или доступ к API Whisper (для транскрибации)
- Python модули из requirements.txt
- Sublime Text (опционально, для редактирования файлов в custom режиме)

## Дополнительные возможности

- **Custom режимы генерации**: Для более точного контроля над процессом генерации текста и кода
- **Различные модели LLM**: Поддержка различных моделей для разных этапов
- **Автоматическая синхронизация аудио и видео**: Использование таймстампов для синхронизации
- **Гибкие настройки качества**: Возможность выбора качества рендера в зависимости от целей
- **Создание обложки**: Открытие видео в mpv и создание скриншота нужного момента через хоткей PrintScreen с использованием maim и xclip
- **Создание статьи для Пикабу**: Генерация текста статьи с кратким содержанием, остротами и юмором

## Примечания

- Для наилучших результатов рекомендуется использовать качественную аудио дорожку
- Таймстампы предложений используются для синхронизации анимации с речью
- Система автоматически регулирует скорость видео для синхронизации с аудио
- В custom режимах используется Sublime Text для интерактивного редактирования
