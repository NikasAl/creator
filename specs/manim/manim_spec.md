# spec_id: m7
## title: Добавить фоновую музыку
## status: сделано

Добавим в @process_manim.sh опциональный шаг в конце добавить фоновую музыку в video.mp4 используя файлы music_xx.mp3. 
Для этого используя pydub или ffmpeg определим уровни громкости в файле video.mp4 и музыкальных файлах. сделаем музыку тише громкости звука и добавим ее фоном в video.mp4

# spec_id: m6
## title: обновить промпт
## status: сделано

после удачного итогового видео надо пересоздать маним анимацию и синхровидео в высоком разрешении

# spec_id: m5
## title: создание промо для Pikabu
## status: сделано

добавить генерацию статьи для пикабу. Попробуем задействовать генератор text_processors/promo_description_processor.py
Потом создается текст (запрос к LLM) статьи для пикабу, где описано краткое содержание с остротами и юмором.
при ошибке сборки маним скрипт долже завершаться, а не переходить к следующему шагу
Убрать про ударения

---

# spec_id: m4
## title: Разделение генерации маним скрипта на 2 части
## status: сделано

process_manim.sh выполняет шаг генерации manim_lesson.py по входным данным и одновременно придумывает сценарий и использует таймстампы для подстройки задержек. Это слишком сложная задача за один запрос. 
Лушче разбить ее на два запроса.
1. Создаем manim_lesson.py на основе урока lesson_script.txt проявляя креативность, визуальные эффекты и выразительность чтобы было ясно и красиво без акцента на задержках и в контекст этого запроса таймстампы не передаем.
2. компилируем этот скрипт и показываем пользователю. Если результат устраивает, то идем дальше
3. Вторым запросом передаем отлаженный скрипт manim_lesson.py и таймстампы с заданием подобрать задержки так, чтобы скрипт и слова в таймстампах оказались синхронизированы. 

---

# spec_id: m3
## title: Разделение генерации урока на 2 части
## status: сделано

process_manim.sh выполняет шаг генерации урока lesson_script.txt по входным данным
использует text_processors/lesson_generator.py - это слишком сложная задача, нужно разбить ее на два шага
1. Создается скрипт урока с понятным объяснением в соответствии с spec.txt и оформлением формул в latex
2. Создаем версию для озвучивания, адаптированную под синтез речи, где произношение формул может быть укорочено, а цифры прописаны вручную и проставлены ударения на словах длиной 10+ символов.
Это требует обновления text_processors/lesson_generator.py и создания нового типа запроса адаптация текста к TTS

---

# spec_id: m2
## title: Генератор обложки
## status: сделано

1 добавить экспорт cover.jpg из указанной секунды video.mp4 Пусть скрипт открывает видео video.mp4 в mpv и предлагает сделать скриншот нужного момента через хоткей PrintScreen - Он использует скрипт maim -s | xclip -selection clipboard -t image/png
и далее по закрытию mpv сохраняет этот скриншот и преобразует в cover.jpg в пайплайне.
Если cover.jpg уже существует то пропускаем этот шаг как в предыдущих шагах
 

---

# spec_id: m1
## title: Генератор уроков с анимацией
## status: сделано

Есть два скрипта setup_manim_pipeline.sh и process_manim.sh, которые должны реализовать пайплайн создания обучающего урока используя manim.

## Суть задачи
Опишу задачу и суть того что должно получиться:
Я решаю задачу по математике или физике и часто сталкиваюсь с затруднением. Либо не могу решить вообще либо ход решения был извилистый и мне нужно создать manim анимацию которая будет давать не просто решение этой задачи, а учитывать именно мои затруднения и ход мыслей по решению задачи. В конце приводить уроки которые были извлечены из этой задачи и список знаний, необходимых для ее решения.

Как входные данные есть изображение задачи из учебника и мои пояснения как решал и какие атруднения были. (как вариант просто фото листка бумаги с моей попыткой решить задачу)

Из этих данных нужно используя LLM получить анимацию manim которая разбирает мой ход решения, затруднения и ошибки, показывает правильные методы, список уроков полученных из этой задачи и навыки которые необходимо развивать, чтобы решать такие задачи в будущем. Также используемые формулы.

В начале скриптом setup_manim_pipeline.sh создаем конфиг с параметрами, которые определяет пользователь.

Затем этот конфиг передается скрипту process_manim.sh <config>

Через LLM получаем текст урока, который будет комментировать анимацию. Этот текст должен содержать все цифры и математические знаки и буквы словами. Он преобразуется в аудио с помощью tts api либо вручную (я пока делаю через сайт heygen). Аудио транскрибируется моделью whisper локально и получаются таймстампы предложений.
Создается manim анимация с учетом задержек из транскрибации, так чтобы была синхронизация со звуком. 
Далее еще происходит дополнительное изменение длины (растяжение/сжатие) анимации через ffmpeg, чтобы она стала ровно такой длины как аудио и звук накладывается на нее. 

После этого по тексту и комментариям создается промо описание  (запрос к LLM) для публикации на Rutube|Youtube. 

## Описание как преобразовать скрипты
Сейчас мои скрипты только частично соответствуют этому пайплайну. 

Можно адаптировать процесс так
setup_manim_pipeline.sh спрашивает параметры конфига, содержание файла spec.txt и путь к фото задачи опционально. Создает pipeline_manim/<pipeline_dir>
И размещает там
spec.txt - описание задачи, того что я делал пытаясь ее решить, мои попытки, возможно итоговое решение и какую анимацию хочу получить, на чем сделать акцент. Например, добавить итог - чему мы научились из этой задачи, навыки нужные для решения.
spec.jpg - изображение задачи (опционально)

setup_manim_pipeline.sh - позволяет выбрать пример кода, на который будет ориентироваться LLM при генерации manim_lesson.py. Мы можем выбрать пример кода из библиотеки manim_processors/solutions и скопировать его в OUTPUT_DIR как manim_example.py, чтобы использовать для генерации итогового кода manim_lesson.py

setup_manim_pipeline.sh запрашивает нужное и создает конфиг с параметрами в каталоге configs/manim
далее я запускаю скрипт process_manim.sh <config_path>
Который реализует описанные в сути действия

## Вот мои скрипты текущий вариант.
setup_manim_pipeline.sh - создание нового пайплайна 
process_manim.sh <config> - выполнение пайплайна по конфигу

## Примеры реализаций
text_processors/illustrations_corrector.py - пример как лучше использовать subl для запроса spec.txt
text_processors/promo_description_processor.py - как обращаться к LLM
configs/manim/alg_skanavi_2_131.conf - пример конфига
manim_processors/solutions/alg_skanavi_1_131.py - пример кода анимации
video_processors/video_transcriber.py - транскрибатор. (можно написать другой, который создает более компактный файл с таймстампами по отдельным предложениям так как в этой задаче не требуется точность по каждому слову)
