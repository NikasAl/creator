–£ –º–µ–Ω—è –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ–∫–Ω–∏–≥ run_pipeline.sh (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –∫–∞–∫ –≤–∏–¥–µ–æ—Ä—è–¥) –∏ —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∞–Ω–∏–º–∞—Ü–∏–π - –∫–æ—Ä–æ—Ç–∫–∏—Ö –∞–Ω–∏–º–∞—Ü–∏–π, –≥–¥–µ –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∫–æ—Ç–æ—Ä–∞—è —Ç–µ–º–∞ —Ñ–æ—Ä–º—É–ª–∞–º–∏ –∏ —Å—Ö–µ–º–∞–º–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞ manim. –•–æ—á—É —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–Ω–æ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–≥—É –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –∏–ª–∏ —Ñ–∏–∑–∏–∫–µ –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —ç—Ç–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤.

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–Ω–∏–≥–∏, –æ—Ü–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è, —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è, —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–º—ã, —Å–æ–∑–¥–∞–µ—Ç—Å—è tts —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è –∏ –ø–æ –Ω–µ–π –∞—É–¥–∏–æ —Å –æ–∑–≤—É—á–∫–æ–π.

–ó–∞—Ç–µ–º –ø–æ –∫–∞–∂–¥–æ–π —Ç–µ–º–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è manim –∫–æ–¥ –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ç–µ–º—É –∏ –∑–∞—Ç–µ–º –∫–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –∞—É–¥–∏–æ. –¢–∞–∫ –∫–∞–∫ –∫–Ω–∏–≥–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–æ–π, –∞ LLM –Ω–µ —Å–º–æ–∂–µ—Ç —Å–≥–µ–Ω–µ–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–π –∫–æ–¥ –∞–Ω–∏–º–∞—Ü–∏–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞, —Ç–æ –ø–æ –∫–∞–∂–¥–æ–º—É –Ω–µ–±–æ–ª—å—à–æ–º—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç—É –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞–¥–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–∞–∫ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π –ø–æ —Ç–µ–º–∞–º, —Ç–∞–∫ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ–º –∫–∞–∫ –≤ –∫–Ω–∏–≥–µ.

–î–∞–≤–∞–π –ø–æ–¥—É–º–∞–µ–º –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å


---


–≠—Ç–æ –æ—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è. –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–∏–≥ —Å –ø–æ–º–æ—â—å—é Manim ‚Äî —ç—Ç–æ **–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ** –∏ **—Å–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞**. –ï—Å–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç—å LLM –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥ –¥–ª—è 30-–º–∏–Ω—É—Ç–Ω–æ–π –≥–ª–∞–≤—ã, –æ–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞—á–Ω–µ—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞—Ç—å, —Ç–µ—Ä—è—Ç—å —Å–∫–æ–±–∫–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º—ã–π "—Å–ø–∞–≥–µ—Ç—Ç–∏-–∫–æ–¥".

–†–µ—à–µ–Ω–∏–µ ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ **"–†–∞–∑–¥–µ–ª—è–π –∏ –í–ª–∞—Å—Ç–≤—É–π" (Divide and Conquer)**.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

–ú—ã —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –ø–∞–π–ø–ª–∞–π–Ω `run_book_manim.sh`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ "–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä".

1.  **–§–∞–∑–∞ "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å" (Ingestion & Splitting):**

      * –ë–µ—Ä–µ—Ç –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç (–∏–∑ PDF –∏–ª–∏ txt).
      * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM (Python-—Å–∫—Ä–∏–ø—Ç) –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ **–°—Ü–µ–Ω—ã**.
      * *–ö—Ä–∏—Ç–µ—Ä–∏–π —Ä–∞–∑–±–∏–µ–Ω–∏—è:* –ö–∞–∂–¥–∞—è —Å—Ü–µ–Ω–∞ ‚Äî —ç—Ç–æ –∑–∞–∫–æ–Ω—á–µ–Ω–Ω–∞—è –º—ã—Å–ª—å/—Ñ–æ—Ä–º—É–ª–∞/–¥–∏–∞–≥—Ä–∞–º–º–∞, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 1-3 –º–∏–Ω—É—Ç—ã.
      * –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª-–º–∞–Ω–∏—Ñ–µ—Å—Ç `project_manifest.json`.

2.  **–§–∞–∑–∞ "–ê–Ω–∏–º–∞—Ç–æ—Ä" (The Loop):**

      * –°–∫—Ä–∏–ø—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ `project_manifest.json`.
      * –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ü–µ–Ω—ã —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥–ø–∞–ø–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `01_introduction`, `02_newton_law`).
      * –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∏–∑ `process_manim.sh` –¥–ª—è —ç—Ç–æ–π –ø–∞–ø–∫–∏.
      * **–í–∞–∂–Ω–æ:** –ú—ã –ø–µ—Ä–µ–¥–∞–µ–º "–í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç" (Style Guide) –≤ –∫–∞–∂–¥—É—é —Å—Ü–µ–Ω—É, —á—Ç–æ–±—ã —Å—Ç–∏–ª—å (—Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç—ã) –±—ã–ª –µ–¥–∏–Ω—ã–º.

3.  **–§–∞–∑–∞ "–ú–æ–Ω—Ç–∞–∂–µ—Ä" (Assembly):**

      * –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω–Ω—ã–µ MP4 —Ñ–∞–π–ª—ã –≤ –æ–¥–∏–Ω –¥–ª–∏–Ω–Ω—ã–π —Ñ–∏–ª—å–º —á–µ—Ä–µ–∑ FFmpeg.

-----

### 1\. Python-—Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–±–∏–µ–Ω–∏—è –Ω–∞ —Å—Ü–µ–Ω—ã (`text_processors/book_segmenter.py`)

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç "—Å—Ç–µ–Ω—É —Ç–µ–∫—Å—Ç–∞" –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω.

````python
import os
import json
import argparse
from langchain_openai import ChatOpenAI
from langchain.schema import HumanMessage, SystemMessage
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞
load_dotenv("config.env")

def split_book_into_scenes(text_content, model_name="gpt-4o"):
    llm = ChatOpenAI(model=model_name, temperature=0.4)
    
    system_prompt = """
    You are an expert educational director visualizing a technical book (Math/Physics) using Manim (Python animation library).
    
    Your goal: Split the provided text into a series of logical "Scenes".
    
    Rules for splitting:
    1. Each scene must be focused on ONE specific concept, formula derivation, or diagram.
    2. Estimated duration of a scene should be between 30 seconds and 3 minutes.
    3. If the text contains a long derivation, split it into steps.
    
    Output Format: JSON list.
    [
        {
            "id": "01",
            "title": "Short_Title_Snake_Case",
            "description": "Visual summary of what happens",
            "raw_text": " The exact text from the book covering this part..."
        },
        ...
    ]
    IMPORTANT: Do not rewrite the 'raw_text', keep it faithful to the source unless it requires minor cleaning for TTS.
    """

    messages = [
        SystemMessage(content=system_prompt),
        HumanMessage(content=f"Here is the book chapter content:\n\n{text_content}")
    ]

    print("ü§ñ Analyzing text structure and splitting into scenes...")
    response = llm.invoke(messages)
    
    # Cleaning the response to ensure valid JSON
    content = response.content.strip()
    if content.startswith("```json"):
        content = content.replace("```json", "").replace("```", "")
    
    try:
        scenes = json.loads(content)
        return scenes
    except json.JSONDecodeError:
        print("‚ùå Error: LLM did not return valid JSON.")
        print(content)
        return []

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("input_file", help="Path to text file")
    parser.add_argument("--output-dir", help="Project output directory")
    args = parser.parse_args()

    with open(args.input_file, "r", encoding="utf-8") as f:
        text = f.read()

    scenes = split_book_into_scenes(text)
    
    manifest_path = os.path.join(args.output_dir, "manifest.json")
    with open(manifest_path, "w", encoding="utf-8") as f:
        json.dump(scenes, f, indent=4, ensure_ascii=False)
        
    print(f"‚úÖ Manifest created with {len(scenes)} scenes at {manifest_path}")
````

### 2\. –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (`run_book_manim.sh`)

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∑–∞–º–µ–Ω—è–µ—Ç —Ä—É—á–Ω–æ–π –≤–≤–æ–¥. –û–Ω –±–µ—Ä–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≤–∞—à–∏—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ (`lib/manim/*.sh`), –Ω–æ –º–µ–Ω—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `OUTPUT_DIR`) –≤ —Ü–∏–∫–ª–µ.

```bash
#!/bin/bash

# run_book_manim.sh
set -e

if [ $# -eq 0 ]; then
    echo "Usage: $0 <book_text.txt> <output_dir>"
    exit 1
fi

INPUT_TEXT="$1"
PROJECT_ROOT="$2"
CONFIG_FILE="config.env"

# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
# –ú—ã –Ω–µ —Å–æ—Ä—Å–∏–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å—Ä–∞–∑—É, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, 
# –ª–∏–±–æ –¥–µ–ª–∞–µ–º —ç—Ç–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ. –í –¥–∞–Ω–Ω–æ–º –¥–∏–∑–∞–π–Ω–µ –º—ã –±—É–¥–µ–º –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ–¥-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ü–µ–Ω—ã,
# —á—Ç–æ–±—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ.

source "$CONFIG_FILE"
mkdir -p "$PROJECT_ROOT"

echo -e "${GREEN}üìö Start Book Visualization Pipeline${NC}"
echo "Input: $INPUT_TEXT"
echo "Root: $PROJECT_ROOT"

# 2. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è (–ï—Å–ª–∏ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –Ω–µ—Ç)
MANIFEST_FILE="$PROJECT_ROOT/manifest.json"

if [ ! -f "$MANIFEST_FILE" ]; then
    echo "üîç Splitting book into scenes..."
    python text_processors/book_segmenter.py "$INPUT_TEXT" --output-dir "$PROJECT_ROOT"
else
    echo "‚úÖ Manifest found, skipping segmentation."
fi

# 3. –ß—Ç–µ–Ω–∏–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –∏ –∑–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞
# –ò—Å–ø–æ–ª—å–∑—É–µ–º jq –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON (—É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ jq —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: sudo apt install jq)
SCENE_COUNT=$(jq '. | length' "$MANIFEST_FILE")

echo "üé¨ Found $SCENE_COUNT scenes. Starting processing..."

for ((i=0; i<SCENE_COUNT; i++)); do
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã
    ID=$(jq -r ".[$i].id" "$MANIFEST_FILE")
    TITLE=$(jq -r ".[$i].title" "$MANIFEST_FILE")
    RAW_TEXT=$(jq -r ".[$i].raw_text" "$MANIFEST_FILE")
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è –ø–∞–ø–∫–∏: 01_Title
    SCENE_DIR="$PROJECT_ROOT/${ID}_${TITLE}"
    mkdir -p "$SCENE_DIR"
    
    echo -e "\n${YELLOW}‚ñ∂ Processing Scene $((i+1))/$SCENE_COUNT: ${ID}_${TITLE}${NC}"
    
    # –°–æ–∑–¥–∞–µ–º spec.txt (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ —Ç–µ–∫—Å—Ç –∫–Ω–∏–≥–∏)
    echo "$RAW_TEXT" > "$SCENE_DIR/spec.txt"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –≤–∏–¥–µ–æ —É–∂–µ –µ—Å—Ç—å, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
    if [ -f "$SCENE_DIR/video.mp4" ]; then
        echo "‚úÖ Scene finished, skipping."
        continue
    fi

    # === –ó–ê–ü–£–°–ö –ú–ò–ù–ò-–ü–ê–ô–ü–õ–ê–ô–ù–ê –î–õ–Ø –°–¶–ï–ù–´ ===
    # –ú—ã –≤—ã–∑—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π wrapper, –ø–µ—Ä–µ–¥–∞–≤–∞—è –µ–º—É –ø–∞–ø–∫—É —Å—Ü–µ–Ω—ã
    ./process_scene_wrapper.sh "$CONFIG_FILE" "$SCENE_DIR"
    
    if [ $? -ne 0 ]; then
        echo -e "${RED}‚ùå Error processing scene $ID. Stopping pipeline.${NC}"
        exit 1
    fi
done

# 4. –°–±–æ—Ä–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ
echo -e "\n${GREEN}üéûÔ∏è Concatenating all scenes...${NC}"
CONCAT_LIST="$PROJECT_ROOT/concat_list.txt"
rm -f "$CONCAT_LIST"

# –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ video.mp4 –≤ –ø–æ–¥–ø–∞–ø–∫–∞—Ö –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö
find "$PROJECT_ROOT" -mindepth 2 -maxdepth 2 -name "video.mp4" | sort > "$PROJECT_ROOT/videos.tmp"

while read video; do
    echo "file '$video'" >> "$CONCAT_LIST"
done < "$PROJECT_ROOT/videos.tmp"
rm "$PROJECT_ROOT/videos.tmp"

FINAL_BOOK_VIDEO="$PROJECT_ROOT/full_book_movie.mp4"
ffmpeg -f concat -safe 0 -i "$CONCAT_LIST" -c copy "$FINAL_BOOK_VIDEO" -y

echo -e "${GREEN}üéâ Book visualization complete: $FINAL_BOOK_VIDEO${NC}"
```

### 3\. –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–π —Å—Ü–µ–Ω—ã (`process_scene_wrapper.sh`)

–ù–∞–º –Ω—É–∂–µ–Ω —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É `process_manim.sh`, –Ω–æ —Å –æ–¥–Ω–∏–º –≤–∞–∂–Ω—ã–º –æ—Ç–ª–∏—á–∏–µ–º: **–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞**.
–í `process_manim.sh` —à–∞–≥ `manim_step_text_gen` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π —Å –Ω—É–ª—è.
–í —Å–ª—É—á–∞–µ –∫–Ω–∏–≥–∏ –Ω–∞–º –Ω—É–∂–Ω–æ **–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–µ–∫—Å—Ç (–∏–∑ `spec.txt`) –¥–ª—è TTS –∏ —Å–∫—Ä–∏–ø—Ç–∞, –∞ –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –Ω–æ–≤—ã–π.

```bash
#!/bin/bash

# process_scene_wrapper.sh
# –ó–∞–ø—É—Å–∫–∞–µ—Ç pipeline –¥–ª—è –æ–¥–Ω–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–∞–ø–∫–∏
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./process_scene_wrapper.sh config.env path/to/scene_dir

CONFIG_FILE="$1"
TARGET_SCENE_DIR="$2"

# 1. –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º OUTPUT_DIR –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –∫–æ–Ω—Ñ–∏–≥–∞
export OUTPUT_DIR="$TARGET_SCENE_DIR"

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥ (–æ–Ω –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –Ω–æ –º—ã –Ω–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –æ–Ω –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç OUTPUT_DIR)
source "$CONFIG_FILE"
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º OUTPUT_DIR, –µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥ –µ–≥–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–ª
export OUTPUT_DIR="$TARGET_SCENE_DIR"

# –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤–æ–π –ø–∞–ø–∫–∏
export SPEC_FILE="$OUTPUT_DIR/spec.txt"
export SCRIPT_FILE="$OUTPUT_DIR/lesson_script.txt"
export TTS_SCRIPT_FILE="$OUTPUT_DIR/lesson_tts.txt"
export AUDIO_FILE="$OUTPUT_DIR/audio.mp3"
export MANIM_DRAFT_FILE="$OUTPUT_DIR/manim_draft.py"
export MANIM_CODE_FILE="$OUTPUT_DIR/manim_lesson.py"
export OUTPUT_VIDEO_FILE="$OUTPUT_DIR/video.mp4"
export TIMESTAMPS_FILE="sentence_timestamps.json"
export FULL_TIMESTAMPS_PATH="$OUTPUT_DIR/$TIMESTAMPS_FILE"

# –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
source "lib/manim/utils.sh"
source "lib/manim/01_text.sh"
source "lib/manim/02_audio.sh"
source "lib/manim/03_code.sh"
source "lib/manim/04_render.sh"

# === –ò–ó–ú–ï–ù–ï–ù–ù–´–ô –®–ê–ì –¢–ï–ö–°–¢–ê ===
# –í–º–µ—Å—Ç–æ manim_step_text_gen (–∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç), –¥–µ–ª–∞–µ–º –∞–¥–∞–ø—Ç–∞—Ü–∏—é
manim_step_book_adapt() {
    log_step "1" "–ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–Ω–∏–≥–∏ –¥–ª—è Manim..."
    if [ ! -f "$SCRIPT_FILE" ] || [ ! -f "$TTS_SCRIPT_FILE" ]; then
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π processor, –Ω–æ —Å –Ω–æ–≤—ã–º —Ñ–ª–∞–≥–æ–º –∏–ª–∏ –ø—Ä–æ–º–ø—Ç–æ–º
        # –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –º—ã –¥–æ–±–∞–≤–∏–ª–∏ action 'book_adapt' –≤ lesson_generator.py
        python text_processors/lesson_generator.py \
            --action book_adapt \
            --input "$SPEC_FILE" \
            --output-script "$SCRIPT_FILE" \
            --output-tts "$TTS_SCRIPT_FILE" \
            --config config.env
    else
        echo "‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–∏ —É–∂–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã."
    fi
}

# === –ó–ê–ü–£–°–ö –®–ê–ì–û–í ===

# 1. –¢–µ–∫—Å—Ç
manim_step_book_adapt

# 2. –ê—É–¥–∏–æ
# –¢—É—Ç –≤–∞–∂–Ω–æ: –¥–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞–º –Ω—É–∂–µ–Ω AUTO-TTS, –∞ –Ω–µ —Ä—É—á–Ω–∞—è –∑–∞–ø–∏—Å—å.
# –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ OpenAI TTS –∏–ª–∏ ElevenLabs, –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —à–∞–≥.
if [ ! -f "$AUDIO_FILE" ]; then
    log_step "2" "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è TTS (Auto)..."
    python text_processors/tts_generator.py \
        --input "$TTS_SCRIPT_FILE" \
        --output "$AUDIO_FILE" \
        --model "openai" # –∏–ª–∏ system/elevenlabs
fi
# –ï—Å–ª–∏ TTS –Ω–µ—Ç, —Å–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ manim_step_wait_audio –∏–∑ utils

manim_step_transcribe

# 3. –ö–æ–¥
manim_step_code_draft
manim_step_compile_draft_loop # –í –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ –ª—É—á—à–µ —É–±—Ä–∞—Ç—å Loop –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ–ø—ã—Ç–∫–∏
manim_step_code_sync

# 4. –†–µ–Ω–¥–µ—Ä
export QUALITY="medium" # –î–ª—è –∫–Ω–∏–≥ –ª—É—á—à–µ medium, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ
manim_step_render_final
manim_step_video_sync

echo "‚úÖ Scene processed: $(basename "$OUTPUT_DIR")"
```

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ Python-–∫–æ–¥–µ

–í–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏–º `book_adapt` –≤ —Ñ–∞–π–ª `text_processors/lesson_generator.py`.

–õ–æ–≥–∏–∫–∞ `book_adapt`:

1.  **Input:** –°—ã—Ä–æ–π —Ç–µ–∫—Å—Ç –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞ –∏–∑ –∫–Ω–∏–≥–∏.
2.  **Prompt:** "–ü–µ—Ä–µ–ø–∏—à–∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è Manim.
      * `lesson_tts.txt`: –¢–µ–∫—Å—Ç –¥–ª—è –¥–∏–∫—Ç–æ—Ä–∞. –°–ª–µ–≥–∫–∞ —É–ø—Ä–æ—Å—Ç–∏ —Å–ª–æ–∂–Ω—ã–µ –æ–±–æ—Ä–æ—Ç—ã, —Å–¥–µ–ª–∞–π –±–æ–ª–µ–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–º, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏ –≤—Å–µ —Ç–µ—Ä–º–∏–Ω—ã.
      * `lesson_script.txt`: –†–∞–∑–±–µ–π –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ñ—Ä–∞–∑—ã –∏ –æ–ø–∏—à–∏, —á—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç (—Ñ–æ—Ä–º—É–ª—ã, –≥—Ä–∞—Ñ–∏–∫–∏)."

### –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

1.  **–ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `run_book_manim.sh`**: –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º, —Ä–∞–∑–±–∏–≤–∞–µ—Ç –∫–Ω–∏–≥—É –Ω–∞ —Å—Ü–µ–Ω—ã.
2.  **–ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `text_processors/book_segmenter.py`**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è —É–º–Ω–æ–π –Ω–∞—Ä–µ–∑–∫–∏ –∫–Ω–∏–≥–∏ –Ω–∞ JSON-–º–∞–Ω–∏—Ñ–µ—Å—Ç.
3.  **–í—Ä–∞–ø–ø–µ—Ä `process_scene_wrapper.sh`**: –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å Manim-–ø–∞–π–ø–ª–∞–π–Ω –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞–ø–∫–∏-—Å—Ü–µ–Ω—ã.
4.  **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è TTS**: –í `process_manim.sh` –±—ã–ª —à–∞–≥ "Wait Audio" (—á–µ–ª–æ–≤–µ–∫ –≤ –∫–æ–Ω—Ç—É—Ä–µ). –î–ª—è –∫–Ω–∏–≥–∏ —ç—Ç–æ –Ω–µ—Ä–µ–∞–ª—å–Ω–æ. –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `tts_generator.py` (—á–µ—Ä–µ–∑ OpenAI API –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π Silero/Coqui), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–∑–≤—É—á–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ –≤—Ä–∞–ø–ø–µ—Ä–∞.

–•–æ—Ç–∏—Ç–µ, —è –Ω–∞–ø–∏—à—É –∫–æ–¥ –¥–ª—è `lesson_generator.py` (—Ä–µ–∂–∏–º book\_adapt) –∏–ª–∏ –¥–ª—è `tts_generator.py`?