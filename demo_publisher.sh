#!/bin/bash
# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤–∏–¥–µ–æ

echo "üé¨ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ –ü–£–ë–õ–ò–ö–ê–¶–ò–ò –í–ò–î–ï–û"
echo "========================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
echo "üîç –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤..."
PIPELINES=$(find . -maxdepth 1 -type d -name "pipeline_*" | head -5)

if [ -z "$PIPELINES" ]; then
    echo "‚ùå –ü–∞–π–ø–ª–∞–π–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    echo "–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–π–ø–ª–∞–π–Ω —Å –ø–æ–º–æ—â—å—é full_pipeline.py"
    exit 1
fi

echo "üìÅ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã:"
echo "$PIPELINES"

# –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –ø–∞–π–ø–ª–∞–π–Ω
PIPELINE=$(echo "$PIPELINES" | head -1)
echo ""
echo "üéØ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–∞–π–ø–ª–∞–π–Ω: $PIPELINE"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–∏–¥–µ–æ
if [ ! -f "$PIPELINE/video.mp4" ]; then
    echo "‚ùå –í–∏–¥–µ–æ—Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: $PIPELINE/video.mp4"
    echo "–°–æ–∑–¥–∞–π—Ç–µ –≤–∏–¥–µ–æ —Å –ø–æ–º–æ—â—å—é –≤–∞—à–µ–≥–æ –≤–∏–¥–µ–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞"
    exit 1
fi

echo "‚úÖ –í–∏–¥–µ–æ—Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
if [ ! -f "config.publisher.env" ]; then
    echo "‚ö†Ô∏è  –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    echo "–°–∫–æ–ø–∏—Ä—É–π—Ç–µ config.publisher.env.example –≤ config.publisher.env"
    echo "–ò –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏"
    exit 1
fi

echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞"

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
echo ""
echo "üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´"
echo "======================"
python test_publisher.py

if [ $? -ne 0 ]; then
    echo "‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø—Ä–æ—à–ª–æ"
    exit 1
fi

echo ""
echo "üöÄ –ó–ê–ü–£–°–ö –ü–£–ë–õ–ò–ö–ê–¶–ò–ò (–ü–†–û–ë–ù–´–ô –†–ï–ñ–ò–ú)"
echo "===================================="
echo "–ö–æ–º–∞–Ω–¥–∞: python publisher.py $PIPELINE --platforms youtube --dry-run"
echo ""

python publisher.py "$PIPELINE" --platforms youtube --dry-run

echo ""
echo "üìã –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø –†–ï–ê–õ–¨–ù–û–ô –ü–£–ë–õ–ò–ö–ê–¶–ò–ò"
echo "===================================="
echo "1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ YouTube API:"
echo "   - –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Google Cloud Console"
echo "   - –í–∫–ª—é—á–∏—Ç–µ YouTube Data API v3"
echo "   - –°–æ–∑–¥–∞–π—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ OAuth 2.0"
echo "   - –°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª youtube_credentials.json"
echo ""
echo "2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏—é:"
echo "   python publisher.py $PIPELINE --platforms youtube --privacy private"
echo ""
echo "3. –î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:"
echo "   python publisher.py $PIPELINE --platforms youtube \\"
echo "     --title \"–ú–æ–µ –≤–∏–¥–µ–æ\" \\"
echo "     --description \"–û–ø–∏—Å–∞–Ω–∏–µ –≤–∏–¥–µ–æ\" \\"
echo "     --tags \"—Ç–µ–≥1\" \"—Ç–µ–≥2\" \"—Ç–µ–≥3\" \\"
echo "     --privacy public"
echo ""
echo "4. –î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –±–µ–∑ LLM:"
echo "   python publisher.py $PIPELINE --platforms youtube --no-llm"
echo ""
echo "‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
