#!/bin/bash

# Проверяем, передан ли аргумент
if [ -z "$1" ]; then
    echo "Ошибка: Не указан каталог с пайплайном."
    echo "Использование: $0 <pipeline_dir>"
    exit 1
fi

# Сохраняем переданный аргумент как путь к пайплайну
PIPELINE_DIR="$1"

# Проверяем, существует ли указанный каталог
if [ ! -d "$PIPELINE_DIR" ]; then
    echo "Ошибка: Каталог $PIPELINE_DIR не существует."
    exit 1
fi

# 1. Устанавливаем разделителем только перенос строки (чтобы пробелы в именах не ломали цикл)
IFS=$'\n'

# 2. Создаем целевую папку для изображений, если её нет
mkdir -p "$PIPELINE_DIR/images/"

# 3. Инициализируем счетчик
count=1

# 4. Запускаем цикл по файлам, отсортированным по времени (ключ -tr)
# Обратите внимание: я сократил маску до Gemini_Generated_Image_*.png для надежности,
# но вы можете вернуть вашу длинную маску, если в папке есть лишние файлы.
for file in $(ls -tr ~/Downloads/Gemini_Generated_Image*.png); do
    # Формируем новое имя с нулем в начале (01, 02...)
    new_name=$(printf "illustration_%02d.png" "$count")
    
    # Копируем файл
    mv "$file" "$PIPELINE_DIR/images/$new_name"
    
    # Выводим сообщение для проверки
    echo "Скопирован: $(basename "$file") -> $new_name"
    
    # Увеличиваем счетчик
    ((count++))
done

# 5. Возвращаем настройки разделителя обратно (на всякий случай)
unset IFS
